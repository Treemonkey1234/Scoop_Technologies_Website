(()=>{var a={};a.id=6863,a.ids=[6863],a.modules={261:a=>{"use strict";a.exports=require("next/dist/shared/lib/router/utils/app-paths")},3295:a=>{"use strict";a.exports=require("next/dist/server/app-render/after-task-async-storage.external.js")},10846:a=>{"use strict";a.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},18963:(a,b,c)=>{"use strict";c.r(b),c.d(b,{handler:()=>G,patchFetch:()=>F,routeModule:()=>B,serverHooks:()=>E,workAsyncStorage:()=>C,workUnitAsyncStorage:()=>D});var d={};c.r(d),c.d(d,{GET:()=>w});var e=c(96559),f=c(48088),g=c(37719),h=c(26191),i=c(81289),j=c(261),k=c(92603),l=c(39893),m=c(14823),n=c(47220),o=c(66946),p=c(47912),q=c(99786),r=c(46143),s=c(86439),t=c(43365),u=c(32190),v=c(84036);async function w(a,b){try{let c=(0,v.$B)();console.log("\uD83D\uDD0D AUTH0 ROUTE: Config validation:",c);let d=(await b.params).auth0[0];switch(console.log("\uD83D\uDD0D AUTH0 ROUTE: Processing route:",d),d){case"login":return x(a);case"logout":return y(a);case"callback":return z(a);case"me":return A(a);default:return u.NextResponse.json({error:"Route not found"},{status:404})}}catch(a){return console.error("\uD83D\uDD0D AUTH0 ROUTE: Critical error:",a),console.error("\uD83D\uDD0D AUTH0 ROUTE: Error stack:",a instanceof Error?a.stack:"No stack trace"),u.NextResponse.json({error:"Authentication error",details:a instanceof Error?a.message:"Unknown error",timestamp:new Date().toISOString()},{status:500})}}async function x(a){let b=new URL(a.url),c=b.searchParams.get("connection"),d=b.searchParams.get("returnTo"),e=new URL(`https://${v.Po.domain}/authorize`);return e.searchParams.set("response_type","code"),e.searchParams.set("client_id",v.Po.clientId),e.searchParams.set("redirect_uri",`${v.Po.baseURL}/api/auth/callback`),e.searchParams.set("scope","openid profile email"),e.searchParams.set("state",btoa(JSON.stringify({returnTo:d||"/",connection:c}))),c&&e.searchParams.set("connection",c),u.NextResponse.redirect(e.toString())}async function y(a){let b=new URL("/api/auth/logout-complete",v.Po.baseURL),c=u.NextResponse.redirect(b.toString());return c.cookies.delete("appSession"),c.cookies.set("appSession","",{maxAge:0,path:"/",httpOnly:!0,secure:!0,sameSite:"lax"}),c}async function z(a){console.log("\uD83D\uDD0D AUTH0 CALLBACK: Starting callback processing"),console.log("\uD83D\uDD0D AUTH0 CALLBACK: Request URL:",a.url);try{let b,c=new URL(a.url),d=c.searchParams.get("code"),e=c.searchParams.get("state")||"{}";if(console.log("\uD83D\uDD0D AUTH0 CALLBACK: Code present:",!!d),console.log("\uD83D\uDD0D AUTH0 CALLBACK: State present:",!!e),!d)return console.log("\uD83D\uDD0D AUTH0 CALLBACK: No code provided, redirecting to signin"),u.NextResponse.redirect(new URL("/signin?error=no_code",v.Po.baseURL));try{b=JSON.parse(atob(e)),console.log("\uD83D\uDD0D AUTH0 CALLBACK: State data parsed:",b)}catch(a){console.log("\uD83D\uDD0D AUTH0 CALLBACK: Failed to parse state, using defaults"),b={returnTo:"/",connection:null}}console.log("\uD83D\uDD0D AUTH0 CALLBACK: Auth0 config check:",{domain:v.Po.domain,clientId:v.Po.clientId?"SET":"MISSING",clientSecret:v.Po.clientSecret?"SET":"MISSING",baseURL:v.Po.baseURL}),console.log("\uD83D\uDD0D AUTH0 CALLBACK: Starting token exchange");let f=await fetch(`https://${v.Po.domain}/oauth/token`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({grant_type:"authorization_code",client_id:v.Po.clientId,client_secret:v.Po.clientSecret,code:d,redirect_uri:`${v.Po.baseURL}/api/auth/callback`})});console.log("\uD83D\uDD0D AUTH0 CALLBACK: Token response status:",f.status),console.log("\uD83D\uDD0D AUTH0 CALLBACK: Token response headers:",Object.fromEntries(f.headers.entries()));let g=await f.json();if(console.log("\uD83D\uDD0D AUTH0 CALLBACK: Token response data:",g),!f.ok)return console.error("\uD83D\uDD0D AUTH0 CALLBACK: Token exchange failed:",g),u.NextResponse.redirect(new URL("/signin?error=token_exchange_failed",v.Po.baseURL));console.log("\uD83D\uDD0D AUTH0 CALLBACK: Starting user info fetch");let h=await fetch(`https://${v.Po.domain}/userinfo`,{headers:{Authorization:`Bearer ${g.access_token}`}});console.log("\uD83D\uDD0D AUTH0 CALLBACK: User response status:",h.status);let i=await h.json();if(console.log("\uD83D\uDD0D AUTH0 CALLBACK: User data:",i),!h.ok)return console.error("\uD83D\uDD0D AUTH0 CALLBACK: User info failed:",i),u.NextResponse.redirect(new URL("/signin?error=user_info_failed",v.Po.baseURL));console.log("\uD83D\uDD0D AUTH0 CALLBACK: Auth0 User Data:",JSON.stringify(i,null,2));try{let a=b.connection||"auth0";console.log("\uD83D\uDD0D AUTH0 CALLBACK: Logging to admin system"),await fetch(`${v.Po.baseURL}/api/admin/users?action=log-auth0-user`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({user_id:i.sub,email:i.email,name:i.name,picture:i.picture,connection:a})}),console.log("\uD83D\uDD0D AUTH0 CALLBACK: Admin logging successful")}catch(a){console.error("\uD83D\uDD0D AUTH0 CALLBACK: Failed to log Auth0 user to admin system:",a)}i.identities=((a,b)=>{let c=[];return a.startsWith("linkedin|")?c.push({provider:"linkedin",connection:"linkedin",user_id:a.split("|")[1],isSocial:!0,profileData:{name:b.name,email:b.email,picture:b.picture}}):a.startsWith("google-oauth2|")?c.push({provider:"google-oauth2",connection:"google-oauth2",user_id:a.split("|")[1],isSocial:!0,profileData:{name:b.name,email:b.email,picture:b.picture}}):a.startsWith("facebook|")&&c.push({provider:"facebook",connection:"facebook",user_id:a.split("|")[1],isSocial:!0,profileData:{name:b.name,email:b.email,picture:b.picture}}),c})(i.sub,i),console.log("\uD83D\uDD0D AUTH0 CALLBACK: Created identities from sub:",JSON.stringify(i.identities,null,2));let j={"google-oauth2":"Google",facebook:"Facebook",linkedin:"LinkedIn",apple:"Apple",microsoft:"Microsoft",github:"GitHub",twitter:"Twitter"},k=null;if(b.connection&&j[b.connection])k=b.connection;else if(i.sub){let a=i.sub.split("|");a.length>1&&j[a[0]]&&(k=a[0])}if(k&&j[k]){let a=j[k],b=i.email?.split("@")[0]||i.nickname||i.name?.split(" ")[0]||"user";console.log("\uD83D\uDD0D AUTH0 CALLBACK: Detected social provider:",a,"with username:",b),i.connectedPlatform=a,i.connectedUsername=b,i.shouldAddToConnectedAccounts=!0}let l={user:{...i,authMethod:"auth0",id:i.sub,username:null},accessToken:g.access_token,expiresAt:Date.now()+1e3*g.expires_in},m=null,n=null;try{console.log("\uD83D\uDD0D AUTH0 CALLBACK: Starting JWT exchange process"),console.log("\uD83D\uDD0D AUTH0 CALLBACK: User data for exchange:",{auth0UserId:i.sub,email:i.email,name:i.name,username:null,phone:null});let a=await fetch(`${v.Po.baseURL}/api/auth/exchange-auth0`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({auth0UserId:i.sub,email:i.email,name:i.name,username:null,phone:null})});if(console.log("\uD83D\uDD0D AUTH0 CALLBACK: Exchange response status:",a.status),console.log("\uD83D\uDD0D AUTH0 CALLBACK: Exchange response headers:",Object.fromEntries(a.headers.entries())),a.ok){let b=await a.json();m=b.token,n=b.user,console.log("\uD83D\uDD0D AUTH0 CALLBACK: JWT exchange successful, token generated"),console.log("\uD83D\uDD0D AUTH0 CALLBACK: Exchange response data:",b),n&&(l.user={...l.user,...n,username:n.username||l.user.username,phone:n.phone||null},console.log("\uD83D\uDD0D AUTH0 CALLBACK: Updated session with backend user data (backend preserves original username):",l.user))}else{let b=await a.text();console.error("\uD83D\uDD0D AUTH0 CALLBACK: JWT exchange failed:",b),console.error("\uD83D\uDD0D AUTH0 CALLBACK: Exchange response status:",a.status)}}catch(a){console.error("\uD83D\uDD0D AUTH0 CALLBACK: JWT exchange error:",a)}let o=b.returnTo;if("/connected-accounts"===b.returnTo)i.isAccountLinking=!0,o="/connected-accounts";else if(b.returnTo&&"/"!==b.returnTo)o=b.returnTo;else{let a=n&&n.username&&n.phone;console.log("\uD83D\uDD0D AUTH0 CALLBACK: Profile completeness check:",{hasBackendUser:!!n,hasUsername:n?.username,hasPhone:n?.phone,hasCompleteProfile:a}),a?(o="/",console.log("\uD83D\uDD0D AUTH0 CALLBACK: User has complete profile, redirecting to home")):(o="/onboarding",console.log("\uD83D\uDD0D AUTH0 CALLBACK: New Auth0 user, redirecting to onboarding for profile completion or account linking"))}console.log("\uD83D\uDD0D AUTH0 CALLBACK: Final redirect path:",o);let p=new URL(o,v.Po.baseURL),q=u.NextResponse.redirect(p.toString()),r=Date.now()+1e3*g.expires_in;if(q.cookies.set("appSession",JSON.stringify(l),{httpOnly:!0,secure:!0,sameSite:"lax",maxAge:g.expires_in||3600,path:"/"}),q.cookies.set("auth0UserData",JSON.stringify(i),{httpOnly:!1,secure:!0,sameSite:"lax",maxAge:g.expires_in||3600,path:"/"}),m){q.cookies.set("authToken",m,{httpOnly:!0,secure:!0,sameSite:"lax",maxAge:604800,path:"/"}),console.log("\uD83D\uDD0D AUTH0 CALLBACK: JWT token stored in cookie");let a=`
        <script>
          (function() {
            console.log('üîç AUTH0 CALLBACK SCRIPT: Starting localStorage injection');
            try {
              localStorage.setItem('authToken', ${JSON.stringify(m)});
              console.log('üîç AUTH0 CALLBACK SCRIPT: JWT token stored in localStorage successfully');
              console.log('üîç AUTH0 CALLBACK SCRIPT: Token length:', ${JSON.stringify(m)}.length);
              console.log('üîç AUTH0 CALLBACK SCRIPT: Token preview:', ${JSON.stringify(m)}.substring(0, 20) + '...');
            } catch (error) {
              console.error('üîç AUTH0 CALLBACK SCRIPT: Failed to store JWT token in localStorage:', error);
            }
          })();
        </script>
      `;console.log("\uD83D\uDD0D AUTH0 CALLBACK: Generated script content length:",a.length),console.log("\uD83D\uDD0D AUTH0 CALLBACK: JWT token length:",m.length),console.log("\uD83D\uDD0D AUTH0 CALLBACK: JWT token preview:",m.substring(0,20)+"...");let b=`
        <!DOCTYPE html>
        <html>
        <head>
          <title>Redirecting...</title>
        </head>
        <body>
          ${a}
          <script>
            console.log('üîç AUTH0 CALLBACK SCRIPT: Redirect script starting');
            // Redirect after storing the token
            setTimeout(function() {
              console.log('üîç AUTH0 CALLBACK SCRIPT: Redirecting to ${p.toString()}');
              window.location.href = '${p.toString()}';
            }, 100);
          </script>
          <p>Redirecting...</p>
        </body>
        </html>
      `;return console.log("\uD83D\uDD0D AUTH0 CALLBACK: Returning HTML response with localStorage injection"),new u.NextResponse(b,{status:200,headers:{"Content-Type":"text/html"}})}return console.log("\uD83D\uDD0D AUTH0 CALLBACK: No JWT token, using original redirect"),console.log("\uD83D\uDD0D AUTH0 CALLBACK: Session created with expiry:",new Date(r).toISOString()),q}catch(a){return console.error("\uD83D\uDD0D AUTH0 CALLBACK: Critical error in callback:",a),console.error("\uD83D\uDD0D AUTH0 CALLBACK: Error stack:",a instanceof Error?a.stack:"No stack trace"),u.NextResponse.redirect(new URL("/signin?error=callback_failed",v.Po.baseURL))}}async function A(a){try{let b=a.cookies.get("appSession");if(b){let a=JSON.parse(b.value);if(a.expiresAt>Date.now())return u.NextResponse.json({user:a.user})}return u.NextResponse.json({user:null})}catch(a){return u.NextResponse.json({user:null})}}let B=new e.AppRouteRouteModule({definition:{kind:f.RouteKind.APP_ROUTE,page:"/api/auth/[...auth0]/route",pathname:"/api/auth/[...auth0]",filename:"route",bundlePath:"app/api/auth/[...auth0]/route"},distDir:".next",projectDir:"",resolvedPagePath:"C:\\Users\\hemin\\Local Files\\Desktop\\Scoop\\Static HTML Scoop\\app\\api\\auth\\[...auth0]\\route.ts",nextConfigOutput:"",userland:d}),{workAsyncStorage:C,workUnitAsyncStorage:D,serverHooks:E}=B;function F(){return(0,g.patchFetch)({workAsyncStorage:C,workUnitAsyncStorage:D})}async function G(a,b,c){var d;let e="/api/auth/[...auth0]/route";"/index"===e&&(e="/");let g=await B.prepare(a,b,{srcPage:e,multiZoneDraftMode:"false"});if(!g)return b.statusCode=400,b.end("Bad Request"),null==c.waitUntil||c.waitUntil.call(c,Promise.resolve()),null;let{buildId:u,params:v,nextConfig:w,isDraftMode:x,prerenderManifest:y,routerServerContext:z,isOnDemandRevalidate:A,revalidateOnlyGenerated:C,resolvedPathname:D}=g,E=(0,j.normalizeAppPath)(e),F=!!(y.dynamicRoutes[E]||y.routes[D]);if(F&&!x){let a=!!y.routes[D],b=y.dynamicRoutes[E];if(b&&!1===b.fallback&&!a)throw new s.NoFallbackError}let G=null;!F||B.isDev||x||(G="/index"===(G=D)?"/":G);let H=!0===B.isDev||!F,I=F&&!H,J=a.method||"GET",K=(0,i.getTracer)(),L=K.getActiveScopeSpan(),M={params:v,prerenderManifest:y,renderOpts:{experimental:{dynamicIO:!!w.experimental.dynamicIO,authInterrupts:!!w.experimental.authInterrupts},supportsDynamicResponse:H,incrementalCache:(0,h.getRequestMeta)(a,"incrementalCache"),cacheLifeProfiles:null==(d=w.experimental)?void 0:d.cacheLife,isRevalidate:I,waitUntil:c.waitUntil,onClose:a=>{b.on("close",a)},onAfterTaskError:void 0,onInstrumentationRequestError:(b,c,d)=>B.onRequestError(a,b,d,z)},sharedContext:{buildId:u}},N=new k.NodeNextRequest(a),O=new k.NodeNextResponse(b),P=l.NextRequestAdapter.fromNodeNextRequest(N,(0,l.signalFromNodeResponse)(b));try{let d=async c=>B.handle(P,M).finally(()=>{if(!c)return;c.setAttributes({"http.status_code":b.statusCode,"next.rsc":!1});let d=K.getRootSpanAttributes();if(!d)return;if(d.get("next.span_type")!==m.BaseServerSpan.handleRequest)return void console.warn(`Unexpected root span type '${d.get("next.span_type")}'. Please report this Next.js issue https://github.com/vercel/next.js`);let e=d.get("next.route");if(e){let a=`${J} ${e}`;c.setAttributes({"next.route":e,"http.route":e,"next.span_name":a}),c.updateName(a)}else c.updateName(`${J} ${a.url}`)}),g=async g=>{var i,j;let k=async({previousCacheEntry:f})=>{try{if(!(0,h.getRequestMeta)(a,"minimalMode")&&A&&C&&!f)return b.statusCode=404,b.setHeader("x-nextjs-cache","REVALIDATED"),b.end("This page could not be found"),null;let e=await d(g);a.fetchMetrics=M.renderOpts.fetchMetrics;let i=M.renderOpts.pendingWaitUntil;i&&c.waitUntil&&(c.waitUntil(i),i=void 0);let j=M.renderOpts.collectedTags;if(!F)return await (0,o.I)(N,O,e,M.renderOpts.pendingWaitUntil),null;{let a=await e.blob(),b=(0,p.toNodeOutgoingHttpHeaders)(e.headers);j&&(b[r.NEXT_CACHE_TAGS_HEADER]=j),!b["content-type"]&&a.type&&(b["content-type"]=a.type);let c=void 0!==M.renderOpts.collectedRevalidate&&!(M.renderOpts.collectedRevalidate>=r.INFINITE_CACHE)&&M.renderOpts.collectedRevalidate,d=void 0===M.renderOpts.collectedExpire||M.renderOpts.collectedExpire>=r.INFINITE_CACHE?void 0:M.renderOpts.collectedExpire;return{value:{kind:t.CachedRouteKind.APP_ROUTE,status:e.status,body:Buffer.from(await a.arrayBuffer()),headers:b},cacheControl:{revalidate:c,expire:d}}}}catch(b){throw(null==f?void 0:f.isStale)&&await B.onRequestError(a,b,{routerKind:"App Router",routePath:e,routeType:"route",revalidateReason:(0,n.c)({isRevalidate:I,isOnDemandRevalidate:A})},z),b}},l=await B.handleResponse({req:a,nextConfig:w,cacheKey:G,routeKind:f.RouteKind.APP_ROUTE,isFallback:!1,prerenderManifest:y,isRoutePPREnabled:!1,isOnDemandRevalidate:A,revalidateOnlyGenerated:C,responseGenerator:k,waitUntil:c.waitUntil});if(!F)return null;if((null==l||null==(i=l.value)?void 0:i.kind)!==t.CachedRouteKind.APP_ROUTE)throw Object.defineProperty(Error(`Invariant: app-route received invalid cache entry ${null==l||null==(j=l.value)?void 0:j.kind}`),"__NEXT_ERROR_CODE",{value:"E701",enumerable:!1,configurable:!0});(0,h.getRequestMeta)(a,"minimalMode")||b.setHeader("x-nextjs-cache",A?"REVALIDATED":l.isMiss?"MISS":l.isStale?"STALE":"HIT"),x&&b.setHeader("Cache-Control","private, no-cache, no-store, max-age=0, must-revalidate");let m=(0,p.fromNodeOutgoingHttpHeaders)(l.value.headers);return(0,h.getRequestMeta)(a,"minimalMode")&&F||m.delete(r.NEXT_CACHE_TAGS_HEADER),!l.cacheControl||b.getHeader("Cache-Control")||m.get("Cache-Control")||m.set("Cache-Control",(0,q.getCacheControlHeader)(l.cacheControl)),await (0,o.I)(N,O,new Response(l.value.body,{headers:m,status:l.value.status||200})),null};L?await g(L):await K.withPropagatedContext(a.headers,()=>K.trace(m.BaseServerSpan.handleRequest,{spanName:`${J} ${a.url}`,kind:i.SpanKind.SERVER,attributes:{"http.method":J,"http.target":a.url}},g))}catch(b){if(L||b instanceof s.NoFallbackError||await B.onRequestError(a,b,{routerKind:"App Router",routePath:E,routeType:"route",revalidateReason:(0,n.c)({isRevalidate:I,isOnDemandRevalidate:A})}),F)throw b;return await (0,o.I)(N,O,new Response(null,{status:500})),null}}},29294:a=>{"use strict";a.exports=require("next/dist/server/app-render/work-async-storage.external.js")},44870:a=>{"use strict";a.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},63033:a=>{"use strict";a.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},78335:()=>{},84036:(a,b,c)=>{"use strict";c.d(b,{$B:()=>e,Po:()=>d});let d={domain:process.env.AUTH0_DOMAIN||"dev-av6q4m54qqcs5n00.us.auth0.com",clientId:process.env.AUTH0_CLIENT_ID||"5uKzDSRavv2WqTOvDnDqsh2pGvHQ759C",clientSecret:process.env.AUTH0_CLIENT_SECRET||"",secret:process.env.AUTH0_SECRET||"8f3e4d2a1b9c7e6f5a8b3c2d9e1f4a7b2c5d8e9f1a4b7c2e5f8a1b4c7d9e2f5a8b",baseURL:process.env.AUTH0_BASE_URL||"https://app.scoopsocials.com",issuerBaseURL:process.env.AUTH0_ISSUER_BASE_URL||`https://${process.env.AUTH0_DOMAIN||"dev-av6q4m54qqcs5n00.us.auth0.com"}`};function e(){let a=[];return process.env.AUTH0_DOMAIN||a.push("AUTH0_DOMAIN"),process.env.AUTH0_CLIENT_ID||a.push("AUTH0_CLIENT_ID"),process.env.AUTH0_CLIENT_SECRET||a.push("AUTH0_CLIENT_SECRET"),process.env.AUTH0_SECRET||a.push("AUTH0_SECRET"),process.env.AUTH0_BASE_URL||process.env.VERCEL_URL||a.push("AUTH0_BASE_URL or VERCEL_URL"),a.length>0&&(console.warn("‚ö†Ô∏è Missing Auth0 environment variables:",a.join(", ")),console.warn("‚ö†Ô∏è Using fallback values - this may cause authentication issues")),{isValid:0===a.length,missingVars:a,config:{domain:d.domain,clientId:d.clientId?"SET":"MISSING",clientSecret:d.clientSecret?"SET":"MISSING",baseURL:d.baseURL,environment:"production"}}}},86439:a=>{"use strict";a.exports=require("next/dist/shared/lib/no-fallback-error.external")},96487:()=>{}};var b=require("../../../../webpack-runtime.js");b.C(a);var c=b.X(0,[4985,6055],()=>b(b.s=18963));module.exports=c})();