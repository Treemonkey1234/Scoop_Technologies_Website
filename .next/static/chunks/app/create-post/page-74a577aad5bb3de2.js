(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[816],{2461:(e,t,s)=>{"use strict";s.d(t,{A:()=>l});var a=s(2115);let l=a.forwardRef(function(e,t){let{title:s,titleId:l,...r}=e;return a.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:t,"aria-labelledby":l},r),s?a.createElement("title",{id:l},s):null,a.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M10.5 19.5 3 12m0 0 7.5-7.5M3 12h18"}))})},5151:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>p});var a=s(5155),l=s(2115),r=s(5695),n=s(3238),i=s(4224),o=s(4236),c=s(2461),d=s(4170),m=s(8046),x=s(2119);let u=l.forwardRef(function(e,t){let{title:s,titleId:a,...r}=e;return l.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:t,"aria-labelledby":a},r),s?l.createElement("title",{id:a},s):null,l.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"m2.25 15.75 5.159-5.159a2.25 2.25 0 0 1 3.182 0l5.159 5.159m-1.5-1.5 1.409-1.409a2.25 2.25 0 0 1 3.182 0l2.909 2.909m-18 3.75h16.5a1.5 1.5 0 0 0 1.5-1.5V6a1.5 1.5 0 0 0-1.5-1.5H3.75A1.5 1.5 0 0 0 2.25 6v12a1.5 1.5 0 0 0 1.5 1.5Zm10.5-11.25h.008v.008h-.008V8.25Zm.375 0a.375.375 0 1 1-.75 0 .375.375 0 0 1 .75 0Z"}))});function h(){var e;let t=(0,r.useRouter)(),s=(0,r.useSearchParams)(),{authState:h,isLoading:p,user:f,requireAuth:b}=(0,o.A)(),g=null==s?void 0:s.get("reviewFor"),v=g?i.vx.find(e=>e.id===parseInt(g)):null;(0,l.useEffect)(()=>{if(console.log("\uD83D\uDD0D CREATE POST PAGE: Authentication effect triggered"),console.log("\uD83D\uDD0D CREATE POST PAGE: Current state:",{authLoading:p,isAuthenticated:h.isAuthenticated,needsOnboarding:h.needsOnboarding,userData:h.user?{id:h.user.id,scoopUserId:h.user.scoopUserId,username:h.user.username,phone:h.user.phone}:null}),p)console.log("\uD83D\uDD0D CREATE POST PAGE: Still loading authentication state...");else{if(!h.isAuthenticated){console.log("\uD83D\uDD0D CREATE POST PAGE: User not authenticated, redirecting to signin"),window.location.href="/signin";return}console.log("\uD83D\uDD0D CREATE POST PAGE: User authenticated, loading data")}},[p,h.isAuthenticated]);let[j,w]=(0,l.useState)([]),[N,y]=(0,l.useState)(!1),C=async()=>{if(null==f?void 0:f.id){y(!0);try{let e=await fetch("/api/friends?userId=".concat(f.id)),t=await e.json();if(e.ok&&t.friends){let e=t.friends.map(e=>({id:e.id,name:e.name,username:e.username,trustScore:e.trust_score||50,avatar:e.avatar_url||e.avatar||"https://images.unsplash.com/photo-1472099645785-5658abf4ff4e?w=150&h=150&fit=crop&crop=face",since:e.since||"2023-01-01"}));w(e),console.log("\uD83D\uDCDD CREATE POST: Loaded ".concat(e.length," friends from API"))}else console.log("\uD83D\uDCDD CREATE POST: No friends found or API error"),w([])}catch(e){console.error("❌ CREATE POST: Error loading friends:",e),w([])}finally{y(!1)}}};(0,l.useEffect)(()=>{(null==f?void 0:f.id)&&!p&&C()},[null==f?void 0:f.id,p]);let[S,A]=(0,l.useState)({reviewFor:(null==v||null==(e=v.id)?void 0:e.toString())||"",category:"",content:"",tags:[],photo:null}),[k,E]=(0,l.useState)(""),[D,F]=(0,l.useState)(!1),[P,T]=(0,l.useState)(!1),O=j.slice(0,5).map(e=>({id:e.id,name:e.name,trustScore:e.trustScore,avatar:e.avatar||"https://images.unsplash.com/photo-1472099645785-5658abf4ff4e?w=150&h=150&fit=crop&crop=face"})),R=j.filter(e=>e.name.toLowerCase().includes(k.toLowerCase())).slice(0,8).map(e=>({id:e.id,name:e.name,trustScore:e.trustScore,avatar:e.avatar||"https://images.unsplash.com/photo-1472099645785-5658abf4ff4e?w=150&h=150&fit=crop&crop=face"})),I=S.reviewFor?j.find(e=>e.id===parseInt(S.reviewFor))||i.vx.find(e=>e.id===parseInt(S.reviewFor)):null,L=e=>{S.tags.includes(e)||A(t=>({...t,tags:[...t.tags,e]}))},_=async e=>{if(e.preventDefault(),S.reviewFor&&S.category&&S.content.trim()){F(!0);try{let e=j.find(e=>e.id===parseInt(S.reviewFor))||i.vx.find(e=>e.id===parseInt(S.reviewFor));if(!e)throw Error("Selected user not found");let s={reviewFor:e.id,reviewForName:e.name,category:S.category,content:S.content,tags:S.tags,isPublic:!0,type:S.category};console.log("\uD83D\uDCE4 Creating post with backend:",s);let a=await fetch("/api/posts",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(s)}),l=await a.json();a.ok?(console.log("✅ Post created successfully:",l),alert("Post about ".concat(e.name," created successfully!")),t.push("/")):(console.error("❌ Post creation failed:",l.error),alert(l.error||"Failed to create post"),F(!1))}catch(e){console.error("Error creating post:",e),alert("An error occurred while creating the post"),F(!1)}}},W=S.content.length;return(0,a.jsxs)(n.default,{children:[(0,a.jsxs)("div",{className:"max-w-2xl mx-auto p-4",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between mb-6 p-4 bg-white rounded-2xl shadow-soft",children:[(0,a.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,a.jsx)("button",{onClick:()=>t.back(),className:"p-2 text-slate-500 hover:text-slate-700 rounded-lg hover:bg-slate-100 transition-colors",children:(0,a.jsx)(c.A,{className:"w-5 h-5"})}),(0,a.jsx)("h1",{className:"text-xl font-bold text-slate-800",children:"✨ Quick Review"})]}),(0,a.jsxs)("button",{onClick:_,disabled:!S.reviewFor||!S.category||!S.content.trim()||D,className:"flex items-center space-x-2 px-6 py-2 bg-gradient-to-r from-cyan-500 to-teal-600 text-white rounded-xl hover:from-cyan-600 hover:to-teal-700 disabled:opacity-50 disabled:cursor-not-allowed transition-all text-sm font-medium",children:[D?"✨":"\uD83D\uDCE4",(0,a.jsx)("span",{children:D?"Posting...":"Post"})]})]}),(0,a.jsxs)("form",{onSubmit:_,className:"space-y-6",children:[(0,a.jsxs)("div",{className:"bg-white rounded-2xl shadow-soft p-6",children:[(0,a.jsxs)("h3",{className:"text-lg font-semibold text-slate-800 mb-4 flex items-center space-x-2",children:[(0,a.jsx)(d.A,{className:"w-5 h-5"}),(0,a.jsx)("span",{children:"\uD83D\uDC64 WHO?"})]}),(0,a.jsxs)("div",{className:"mb-4",children:[(0,a.jsxs)("div",{className:"relative",children:[(0,a.jsx)(m.A,{className:"w-5 h-5 absolute left-3 top-3 text-slate-400"}),(0,a.jsx)("input",{type:"text",placeholder:"Type a friend's name to search...",className:"w-full pl-10 pr-12 py-3 border border-slate-200 rounded-xl focus:ring-2 focus:ring-cyan-500 focus:border-transparent",value:k,onChange:e=>E(e.target.value)}),k&&(0,a.jsx)("button",{type:"button",onClick:()=>E(""),className:"absolute right-3 top-3 text-slate-400 hover:text-slate-600 transition-colors",children:(0,a.jsx)(x.A,{className:"w-5 h-5"})})]}),k&&(0,a.jsx)("p",{className:"text-xs text-slate-500 mt-1",children:"\uD83D\uDCA1 Tip: Click on a friend to select them for your review"})]}),!k&&j.length>5&&(0,a.jsx)("div",{className:"mb-4",children:(0,a.jsx)("button",{type:"button",onClick:()=>T(!0),className:"w-full p-3 border-2 border-dashed border-slate-300 rounded-xl hover:border-cyan-400 hover:bg-cyan-50 transition-all text-slate-600 hover:text-cyan-700",children:(0,a.jsxs)("div",{className:"flex items-center justify-center space-x-2",children:[(0,a.jsx)(d.A,{className:"w-5 h-5"}),(0,a.jsxs)("span",{className:"font-medium",children:["See All Friends (",j.length,")"]})]})})}),N?(0,a.jsxs)("div",{className:"text-center py-6",children:[(0,a.jsx)("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-cyan-500 mx-auto mb-2"}),(0,a.jsx)("p",{className:"text-sm text-slate-500",children:"Loading your friends..."})]}):k?(0,a.jsxs)("div",{className:"mb-4",children:[(0,a.jsx)("p",{className:"text-sm text-slate-600 mb-2",children:"Search Results:"}),(0,a.jsx)("div",{className:"space-y-2 max-h-64 overflow-y-auto",children:R.length>0?R.map(e=>(0,a.jsx)("button",{type:"button",onClick:()=>{A(t=>({...t,reviewFor:e.id.toString()})),E("")},className:"w-full text-left p-3 rounded-xl border-2 transition-all ".concat(S.reviewFor===e.id.toString()?"border-cyan-500 bg-cyan-50":"border-slate-200 hover:border-slate-300 hover:bg-slate-50"),children:(0,a.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,a.jsx)("img",{src:e.avatar,alt:e.name,className:"w-10 h-10 rounded-full object-cover"}),(0,a.jsx)("div",{className:"flex-1",children:(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("span",{className:"font-medium text-slate-800",children:[e.name," ",S.reviewFor===e.id.toString()&&"✓"]}),(0,a.jsx)("span",{className:"text-sm text-slate-600 bg-slate-100 px-2 py-1 rounded",children:e.trustScore})]})})]})},e.id)):(0,a.jsxs)("div",{className:"text-center py-4 text-slate-500",children:[(0,a.jsx)(d.A,{className:"w-8 h-8 mx-auto mb-2 opacity-50"}),(0,a.jsxs)("p",{children:['No friends found matching "',k,'"']})]})})]}):(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-sm text-slate-600 mb-3",children:j.length>0?"Your 5 Most Recent Friends:":"Your Friends:"}),(0,a.jsx)("div",{className:"space-y-2",children:O.length>0?O.map(e=>(0,a.jsx)("button",{type:"button",onClick:()=>A(t=>({...t,reviewFor:e.id.toString()})),className:"w-full text-left p-3 rounded-xl border-2 transition-all ".concat(S.reviewFor===e.id.toString()?"border-cyan-500 bg-cyan-50":"border-slate-200 hover:border-slate-300 hover:bg-slate-50"),children:(0,a.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,a.jsx)("img",{src:e.avatar,alt:e.name,className:"w-10 h-10 rounded-full object-cover"}),(0,a.jsx)("div",{className:"flex-1",children:(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("span",{className:"font-medium text-slate-800",children:[e.name," ",S.reviewFor===e.id.toString()&&"✓"]}),(0,a.jsx)("span",{className:"text-sm text-slate-600 bg-slate-100 px-2 py-1 rounded",children:e.trustScore})]})})]})},e.id)):(0,a.jsxs)("div",{className:"text-center py-6 text-slate-500",children:[(0,a.jsx)(d.A,{className:"w-12 h-12 mx-auto mb-3 opacity-50"}),(0,a.jsx)("p",{className:"font-medium",children:"No friends yet"}),(0,a.jsxs)("p",{className:"text-sm",children:[(0,a.jsx)("button",{onClick:()=>t.push("/friends"),className:"text-cyan-600 hover:text-cyan-700 underline",children:"Add some friends"})," to write reviews!"]})]})})]})]}),(0,a.jsxs)("div",{className:"bg-white rounded-2xl shadow-soft p-6",children:[(0,a.jsx)("h3",{className:"text-lg font-semibold text-slate-800 mb-4",children:"\uD83D\uDCDD WHAT ABOUT?"}),(0,a.jsx)("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-3",children:[{id:"professional",label:"\uD83D\uDCBC Professional",emoji:"\uD83D\uDCBC"},{id:"marketplace",label:"\uD83D\uDED2 Marketplace",emoji:"\uD83D\uDED2"},{id:"dating",label:"\uD83D\uDC95 Dating",emoji:"\uD83D\uDC95"},{id:"social",label:"\uD83E\uDD1D Social",emoji:"\uD83E\uDD1D"},{id:"general",label:"\uD83D\uDD17 General",emoji:"\uD83D\uDD17"}].map(e=>(0,a.jsxs)("button",{type:"button",onClick:()=>{var t;return t=e.id,void A(e=>({...e,category:t}))},className:"p-4 rounded-xl border-2 text-sm font-medium transition-all ".concat(S.category===e.id?"border-cyan-500 bg-cyan-50 text-cyan-700":"border-slate-200 hover:border-slate-300 text-slate-600"),children:[e.label,S.category===e.id&&(0,a.jsx)("div",{className:"mt-1 text-xs text-cyan-600",children:"████"})]},e.id))})]}),(0,a.jsxs)("div",{className:"bg-white rounded-2xl shadow-soft p-6",children:[(0,a.jsx)("h3",{className:"text-lg font-semibold text-slate-800 mb-4",children:"✍️ YOUR REVIEW"}),(0,a.jsx)("textarea",{placeholder:I?"".concat(I.name," was amazing to work with on our React project. Super responsive and delivered quality code on time. Would definitely collaborate again! \uD83D\uDE80"):"Alex was amazing to work with on our React project. Super responsive and delivered quality code on time. Would definitely collaborate again! \uD83D\uDE80",className:"w-full h-28 p-4 border border-slate-200 rounded-xl focus:ring-2 focus:ring-cyan-500 focus:border-transparent resize-none",value:S.content,onChange:e=>A(t=>({...t,content:e.target.value})),maxLength:300}),(0,a.jsxs)("div",{className:"flex justify-between items-center mt-3",children:[(0,a.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,a.jsxs)("label",{className:"flex items-center space-x-2 text-sm text-cyan-600 hover:text-cyan-700 cursor-pointer",children:[(0,a.jsx)(u,{className:"w-5 h-5"}),(0,a.jsx)("span",{children:"\uD83D\uDCF8 Add Photo"}),(0,a.jsx)("input",{type:"file",accept:"image/*",onChange:e=>{var t;let s=null==(t=e.target.files)?void 0:t[0];s&&A(e=>({...e,photo:s}))},className:"hidden"})]}),S.photo&&(0,a.jsxs)("span",{className:"text-sm text-green-600",children:["✅ ",S.photo.name]})]}),(0,a.jsxs)("span",{className:"text-sm ".concat(W>270?"text-orange-600":"text-slate-500"),children:[W,"/",300," chars"]})]})]}),(0,a.jsxs)("div",{className:"bg-white rounded-2xl shadow-soft p-6",children:[(0,a.jsx)("h3",{className:"text-lg font-semibold text-slate-800 mb-4",children:"\uD83C\uDFF7️ Quick Tags:"}),(0,a.jsxs)("div",{className:"flex flex-wrap gap-2 mb-4",children:[["#reliable","#skilled","#responsive","#professional","#recommended"].map(e=>(0,a.jsx)("button",{type:"button",onClick:()=>L(e),disabled:S.tags.includes(e),className:"px-3 py-1 rounded-full text-sm transition-all ".concat(S.tags.includes(e)?"bg-cyan-100 text-cyan-700 cursor-not-allowed":"bg-slate-100 text-slate-600 hover:bg-cyan-50 hover:text-cyan-600"),children:e},e)),(0,a.jsx)("button",{type:"button",className:"px-3 py-1 rounded-full text-sm bg-slate-100 text-slate-600 hover:bg-cyan-50 hover:text-cyan-600 transition-all",onClick:()=>{let e=prompt("Enter custom tag (without #):");e&&e.trim()&&L("#".concat(e.trim()))},children:"+ Custom"})]}),S.tags.length>0&&(0,a.jsx)("div",{className:"flex flex-wrap gap-2",children:S.tags.map(e=>(0,a.jsxs)("span",{className:"flex items-center space-x-1 px-3 py-1 bg-cyan-100 text-cyan-700 rounded-full text-sm",children:[(0,a.jsx)("span",{children:e}),(0,a.jsx)("button",{type:"button",onClick:()=>{A(t=>({...t,tags:t.tags.filter(t=>t!==e)}))},className:"text-cyan-500 hover:text-cyan-700",children:(0,a.jsx)(x.A,{className:"w-3 h-3"})})]},e))})]}),(0,a.jsx)("div",{className:"bg-white rounded-2xl shadow-soft p-6",children:(0,a.jsx)("p",{className:"text-sm text-slate-600 text-center",children:"\uD83D\uDD12 This review will be public • Trust scores may be affected"})})]})]}),P&&(0,a.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:(0,a.jsxs)("div",{className:"bg-white rounded-2xl shadow-2xl max-w-md w-full max-h-[80vh] overflow-hidden",children:[(0,a.jsxs)("div",{className:"p-6 border-b border-slate-200",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsx)("h3",{className:"text-xl font-bold text-slate-800",children:"\uD83D\uDC65 Choose Friend"}),(0,a.jsx)("button",{onClick:()=>T(!1),className:"p-2 hover:bg-slate-100 rounded-full transition-colors",children:(0,a.jsx)(x.A,{className:"w-6 h-6 text-slate-600"})})]}),(0,a.jsx)("p",{className:"text-sm text-slate-600 mt-2",children:"Select a friend to write a review about"})]}),(0,a.jsx)("div",{className:"overflow-y-auto max-h-96",children:N?(0,a.jsxs)("div",{className:"text-center py-8",children:[(0,a.jsx)("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-cyan-500 mx-auto mb-2"}),(0,a.jsx)("p",{className:"text-sm text-slate-500",children:"Loading your friends..."})]}):j.length>0?(0,a.jsx)("div",{className:"p-4 space-y-2",children:j.map(e=>(0,a.jsx)("button",{type:"button",onClick:()=>{A(t=>({...t,reviewFor:e.id.toString()})),T(!1)},className:"w-full text-left p-4 rounded-xl border-2 transition-all ".concat(S.reviewFor===e.id.toString()?"border-cyan-500 bg-cyan-50":"border-slate-200 hover:border-slate-300 hover:bg-slate-50"),children:(0,a.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,a.jsx)("img",{src:e.avatar||"https://images.unsplash.com/photo-1472099645785-5658abf4ff4e?w=150&h=150&fit=crop&crop=face",alt:e.name,className:"w-12 h-12 rounded-full object-cover"}),(0,a.jsxs)("div",{className:"flex-1",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("span",{className:"font-medium text-slate-800",children:[e.name," ",S.reviewFor===e.id.toString()&&"✓"]}),(0,a.jsx)("span",{className:"text-sm text-slate-600 bg-slate-100 px-2 py-1 rounded",children:e.trustScore})]}),(0,a.jsxs)("p",{className:"text-sm text-slate-500 mt-1",children:["Friends since ",new Date(e.since||"2023-01-01").getFullYear()]})]})]})},e.id))}):(0,a.jsxs)("div",{className:"text-center py-8 text-slate-500",children:[(0,a.jsx)(d.A,{className:"w-12 h-12 mx-auto mb-3 opacity-50"}),(0,a.jsx)("p",{className:"font-medium",children:"No friends yet"}),(0,a.jsxs)("p",{className:"text-sm",children:[(0,a.jsx)("button",{onClick:()=>{T(!1),t.push("/friends")},className:"text-cyan-600 hover:text-cyan-700 underline",children:"Add some friends"})," to write reviews!"]})]})}),(0,a.jsx)("div",{className:"p-4 border-t border-slate-200 bg-slate-50",children:(0,a.jsx)("button",{onClick:()=>T(!1),className:"w-full px-4 py-2 bg-slate-200 hover:bg-slate-300 text-slate-700 rounded-xl text-sm font-medium transition-colors",children:"Cancel"})})]})})]})}function p(){return(0,a.jsx)(l.Suspense,{fallback:(0,a.jsx)(n.default,{children:(0,a.jsx)("div",{className:"max-w-2xl mx-auto p-4",children:(0,a.jsxs)("div",{className:"animate-pulse",children:[(0,a.jsx)("div",{className:"h-8 bg-slate-200 rounded w-1/4 mb-4"}),(0,a.jsx)("div",{className:"h-4 bg-slate-200 rounded w-1/2 mb-8"}),(0,a.jsx)("div",{className:"bg-white rounded-2xl shadow-soft p-6",children:(0,a.jsx)("div",{className:"h-20 bg-slate-200 rounded"})})]})})}),children:(0,a.jsx)(h,{})})}},8188:(e,t,s)=>{Promise.resolve().then(s.bind(s,5151))}},e=>{e.O(0,[4684,4236,3238,8441,5964,7358],()=>e(e.s=8188)),_N_E=e.O()}]);