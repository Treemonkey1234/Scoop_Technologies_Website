(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[1863],{4415:(e,t,s)=>{Promise.resolve().then(s.bind(s,6438))},6438:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>c});var a=s(5155),l=s(2115),n=s(5695),r=s(3238),d=s(4236);function c(){let e=(0,n.useRouter)(),{authState:t,isLoading:s}=(0,d.A)(),[c,i]=(0,l.useState)([]),[o,x]=(0,l.useState)(null),[m,h]=(0,l.useState)(!1),[u,p]=(0,l.useState)(""),[b,j]=(0,l.useState)([]),[g,f]=(0,l.useState)([]),[v,N]=(0,l.useState)(!1),[y,w]=(0,l.useState)("all"),D=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"info";f(s=>['<div style="color: '.concat("error"===t?"red":"success"===t?"green":"black",'; margin-bottom: 5px;">[').concat(new Date().toLocaleTimeString(),"] ").concat(e,"</div>"),...s].slice(0,100))},E=(0,l.useCallback)(async()=>{h(!0);try{let e=await fetch("/api/admin/events/stats"),t=await e.json();t.success?(x(t.stats),D("Event stats loaded successfully","success")):D("Failed to load stats: "+t.error,"error")}catch(e){D("Error loading stats: "+e.message,"error")}h(!1)},[]),_=(0,l.useCallback)(async()=>{h(!0);try{let e=await fetch("/api/admin/events"),t=await e.json();t.success?(i(t.events),D("Loaded ".concat(t.count," events"),"success")):D("Failed to load events: "+t.error,"error")}catch(e){D("Error loading events: "+e.message,"error")}h(!1)},[]),C=async()=>{if(!u)return void D("Please enter an event title","error");h(!0);try{let e=await fetch("/api/admin/events/search/".concat(encodeURIComponent(u))),t=await e.json();t.success?(j(t.events),D("Found ".concat(t.count,' events matching "').concat(u,'"'),"success")):(j([]),D("No events found","error"))}catch(e){D("Error searching events: "+e.message,"error")}h(!1)},k=async(e,t)=>{if(confirm('Are you sure you want to delete event: "'.concat(t,'"?'))){h(!0);try{let s=await fetch("/api/admin/events/".concat(e),{method:"DELETE"}),a=await s.json();a.success?(D('Event deleted successfully: "'.concat(t,'"'),"success"),_(),E(),j(t=>t.filter(t=>t.id!==e))):D("Failed to delete event: "+a.error,"error")}catch(e){D("Error deleting event: "+e.message,"error")}h(!1)}},L=async()=>{if(confirm("Delete all orphaned events (events without valid host_id)?")){h(!0);try{let t=await fetch("/api/admin/cleanup-orphaned-events",{method:"POST"}),s=await t.json();if(s.success){var e;D("Cleaned up ".concat((null==(e=s.deletedEvents)?void 0:e.length)||0," orphaned events"),"success"),_(),E()}else D("Failed to cleanup orphaned events: "+s.error,"error")}catch(e){D("Error cleaning up orphaned events: "+e.message,"error")}h(!1)}},A=async()=>{if("DELETE ALL EVENTS"!==prompt('This will delete ALL events! Type "DELETE ALL EVENTS" to confirm:'))return void D("Delete all events cancelled","info");h(!0);try{let e=await fetch("/api/admin/events/ALL/confirm-delete-all",{method:"DELETE"}),t=await e.json();t.success?(D("All events deleted. Count: ".concat(t.deletedCount),"success"),_(),E(),j([])):D("Failed to delete all events: "+t.error,"error")}catch(e){D("Error deleting all events: "+e.message,"error")}h(!1)};(0,l.useEffect)(()=>{if(!s){var a;if(!t.isAuthenticated)return void e.push("/signin");N(!0),D("Access granted for ".concat((null==(a=t.user)?void 0:a.email)||"unknown user"),"success"),E(),_()}},[s,t.isAuthenticated,t.user,e,E,_]);let S=c.filter(e=>{let t=new Date,s=new Date(e.event_date);switch(y){case"upcoming":return s>t;case"past":return s<=t;case"private":return!0===e.is_private;case"public":return!1===e.is_private||null===e.is_private;case"orphaned":return!e.host_id||!e.host_name;default:return!0}}),T=e=>new Date(e).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"});return s?(0,a.jsx)(r.default,{children:(0,a.jsx)("div",{className:"min-h-screen bg-gradient-to-br from-slate-50 to-blue-50 flex items-center justify-center",children:(0,a.jsxs)("div",{className:"bg-white rounded-xl shadow-soft p-8 border border-slate-200 text-center max-w-md",children:[(0,a.jsx)("div",{className:"w-16 h-16 bg-blue-100 rounded-full flex items-center justify-center mx-auto mb-4",children:(0,a.jsx)("div",{className:"w-8 h-8 border-4 border-blue-600 border-t-transparent rounded-full animate-spin"})}),(0,a.jsx)("h1",{className:"text-2xl font-bold text-slate-800 mb-2",children:"\uD83C\uDF89 Event Management"}),(0,a.jsx)("p",{className:"text-slate-600",children:"Checking authentication..."})]})})}):v?(0,a.jsx)(r.default,{children:(0,a.jsx)("div",{className:"min-h-screen bg-gradient-to-br from-slate-50 to-blue-50",children:(0,a.jsxs)("div",{className:"max-w-7xl mx-auto p-6",children:[(0,a.jsxs)("div",{className:"mb-8",children:[(0,a.jsx)("h1",{className:"text-3xl font-bold text-slate-800 mb-2",children:"\uD83C\uDF89 Event Management"}),(0,a.jsx)("p",{className:"text-slate-600",children:"Manage events, view statistics, and moderate content"})]}),(0,a.jsxs)("div",{className:"bg-blue-50 border border-blue-200 rounded-xl p-4 mb-6",children:[(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,a.jsx)("div",{className:"w-5 h-5 bg-blue-500 rounded-full flex items-center justify-center",children:(0,a.jsx)("span",{className:"text-white text-xs",children:"ℹ"})}),(0,a.jsx)("p",{className:"text-blue-800 font-medium",children:"Admin Access Active"})]}),(0,a.jsx)("p",{className:"text-blue-700 text-sm mt-1",children:"You have administrative privileges to manage events and view detailed analytics."})]}),(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8",children:[(0,a.jsx)("div",{className:"bg-white rounded-xl shadow-soft p-6 border border-slate-200",children:(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-slate-600 text-sm font-medium",children:"Total Events"}),(0,a.jsx)("p",{className:"text-2xl font-bold text-slate-800 mt-1",children:o?o.totalEvents||"0":(0,a.jsx)("span",{className:"text-slate-400",children:"Loading..."})})]}),(0,a.jsx)("div",{className:"w-12 h-12 bg-blue-100 rounded-lg flex items-center justify-center",children:(0,a.jsx)("span",{className:"text-blue-600 text-xl",children:"\uD83C\uDF89"})})]})}),(0,a.jsx)("div",{className:"bg-white rounded-xl shadow-soft p-6 border border-slate-200",children:(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-slate-600 text-sm font-medium",children:"Upcoming Events"}),(0,a.jsx)("p",{className:"text-2xl font-bold text-slate-800 mt-1",children:o?o.upcomingEvents||"0":(0,a.jsx)("span",{className:"text-slate-400",children:"Loading..."})})]}),(0,a.jsx)("div",{className:"w-12 h-12 bg-green-100 rounded-lg flex items-center justify-center",children:(0,a.jsx)("span",{className:"text-green-600 text-xl",children:"⏰"})})]})}),(0,a.jsx)("div",{className:"bg-white rounded-xl shadow-soft p-6 border border-slate-200",children:(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-slate-600 text-sm font-medium",children:"Private Events"}),(0,a.jsx)("p",{className:"text-2xl font-bold text-slate-800 mt-1",children:o?o.privateEvents||"0":(0,a.jsx)("span",{className:"text-slate-400",children:"Loading..."})})]}),(0,a.jsx)("div",{className:"w-12 h-12 bg-orange-100 rounded-lg flex items-center justify-center",children:(0,a.jsx)("span",{className:"text-orange-600 text-xl",children:"\uD83D\uDD12"})})]})}),(0,a.jsx)("div",{className:"bg-white rounded-xl shadow-soft p-6 border border-slate-200",children:(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-slate-600 text-sm font-medium",children:"Orphaned Events"}),(0,a.jsx)("p",{className:"text-2xl font-bold text-slate-800 mt-1",children:o?o.orphanedEvents||"0":(0,a.jsx)("span",{className:"text-slate-400",children:"Loading..."})})]}),(0,a.jsx)("div",{className:"w-12 h-12 bg-red-100 rounded-lg flex items-center justify-center",children:(0,a.jsx)("span",{className:"text-red-600 text-xl",children:"⚠️"})})]})})]}),(0,a.jsxs)("div",{className:"bg-white rounded-xl shadow-soft p-6 border border-slate-200 mb-8",children:[(0,a.jsx)("h2",{className:"text-xl font-semibold text-slate-800 mb-6",children:"Event Management Controls"}),(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4 mb-6",children:[(0,a.jsx)("button",{onClick:_,disabled:m,className:"flex items-center justify-center px-4 py-3 bg-blue-600 hover:bg-blue-700 disabled:bg-slate-300 text-white rounded-lg font-medium transition-colors duration-200",children:m?"⏳ Loading...":"\uD83C\uDF89 Load All Events"}),(0,a.jsx)("button",{onClick:E,disabled:m,className:"flex items-center justify-center px-4 py-3 bg-green-600 hover:bg-green-700 disabled:bg-slate-300 text-white rounded-lg font-medium transition-colors duration-200",children:m?"⏳ Loading...":"\uD83D\uDCCA Refresh Stats"}),(0,a.jsx)("button",{onClick:L,disabled:m,className:"flex items-center justify-center px-4 py-3 bg-yellow-600 hover:bg-yellow-700 disabled:bg-slate-300 text-white rounded-lg font-medium transition-colors duration-200",children:m?"⏳ Loading...":"\uD83E\uDDF9 Cleanup Orphaned"}),(0,a.jsx)("button",{onClick:()=>{i([]),x(null),j([]),f([]),D("Cache cleared - all data reset","success")},disabled:m,className:"flex items-center justify-center px-4 py-3 bg-purple-600 hover:bg-purple-700 disabled:bg-slate-300 text-white rounded-lg font-medium transition-colors duration-200",children:"\uD83E\uDDF9 Clear Cache"})]}),(0,a.jsxs)("div",{className:"bg-slate-50 rounded-lg p-4 mb-6",children:[(0,a.jsx)("h3",{className:"text-lg font-semibold text-slate-800 mb-4",children:"\uD83D\uDD0D Search Events"}),(0,a.jsxs)("div",{className:"flex gap-3",children:[(0,a.jsx)("input",{type:"text",value:u,onChange:e=>p(e.target.value),onKeyPress:e=>"Enter"===e.key&&C(),placeholder:"Enter event title to search...",className:"flex-1 px-4 py-2 border border-slate-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"}),(0,a.jsx)("button",{onClick:C,disabled:m,className:"px-6 py-2 bg-blue-600 hover:bg-blue-700 disabled:bg-slate-300 text-white rounded-lg font-medium",children:"Search"}),(0,a.jsx)("button",{onClick:()=>{p(""),j([])},className:"px-4 py-2 bg-slate-500 hover:bg-slate-600 text-white rounded-lg font-medium",children:"Clear"})]})]}),(0,a.jsxs)("div",{className:"bg-slate-50 rounded-lg p-4 mb-6",children:[(0,a.jsx)("h3",{className:"text-lg font-semibold text-slate-800 mb-4",children:"\uD83D\uDD27 Filter Events"}),(0,a.jsx)("div",{className:"flex flex-wrap gap-2",children:[{key:"all",label:"All Events",icon:"\uD83C\uDF89"},{key:"upcoming",label:"Upcoming",icon:"⏰"},{key:"past",label:"Past",icon:"\uD83D\uDCC5"},{key:"public",label:"Public",icon:"\uD83C\uDF0D"},{key:"private",label:"Private",icon:"\uD83D\uDD12"},{key:"orphaned",label:"Orphaned",icon:"⚠️"}].map(e=>(0,a.jsxs)("button",{onClick:()=>w(e.key),className:"px-4 py-2 rounded-lg font-medium transition-colors duration-200 ".concat(y===e.key?"bg-blue-600 text-white":"bg-white text-slate-700 border border-slate-300 hover:bg-slate-100"),children:[e.icon," ",e.label]},e.key))})]}),(0,a.jsxs)("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4",children:[(0,a.jsx)("h3",{className:"text-lg font-semibold text-red-800 mb-4",children:"⚠️ Danger Zone"}),(0,a.jsx)("div",{className:"flex gap-3",children:(0,a.jsx)("button",{onClick:A,disabled:m,className:"px-6 py-2 bg-red-600 hover:bg-red-700 disabled:bg-slate-300 text-white rounded-lg font-medium",children:"\uD83D\uDCA5 Delete ALL Events"})}),(0,a.jsx)("p",{className:"text-red-700 text-sm mt-2",children:"⚠️ Permanent actions - use with extreme caution!"})]})]}),b.length>0&&(0,a.jsxs)("div",{className:"bg-white rounded-xl shadow-soft p-6 border border-slate-200 mb-8",children:[(0,a.jsxs)("h2",{className:"text-xl font-semibold text-slate-800 mb-4",children:["\uD83D\uDD0D Search Results (",b.length,")"]}),(0,a.jsx)("div",{className:"overflow-x-auto",children:(0,a.jsxs)("table",{className:"w-full text-sm",children:[(0,a.jsx)("thead",{children:(0,a.jsxs)("tr",{className:"border-b border-slate-200",children:[(0,a.jsx)("th",{className:"text-left py-3 px-2",children:"ID"}),(0,a.jsx)("th",{className:"text-left py-3 px-2",children:"Title"}),(0,a.jsx)("th",{className:"text-left py-3 px-2",children:"Host"}),(0,a.jsx)("th",{className:"text-left py-3 px-2",children:"Date"}),(0,a.jsx)("th",{className:"text-left py-3 px-2",children:"Location"}),(0,a.jsx)("th",{className:"text-left py-3 px-2",children:"Status"}),(0,a.jsx)("th",{className:"text-left py-3 px-2",children:"Actions"})]})}),(0,a.jsx)("tbody",{children:b.map(e=>(0,a.jsxs)("tr",{className:"border-b border-slate-100 hover:bg-slate-50",children:[(0,a.jsx)("td",{className:"py-3 px-2 font-mono text-xs",children:e.id}),(0,a.jsx)("td",{className:"py-3 px-2 font-medium",children:e.title}),(0,a.jsxs)("td",{className:"py-3 px-2",children:[e.host_name||"Unknown",e.host_username&&(0,a.jsxs)("span",{className:"text-slate-500 text-xs",children:["(@",e.host_username,")"]})]}),(0,a.jsx)("td",{className:"py-3 px-2",children:T(e.event_date)}),(0,a.jsx)("td",{className:"py-3 px-2",children:e.location_name}),(0,a.jsxs)("td",{className:"py-3 px-2",children:[(0,a.jsx)("span",{className:"px-2 py-1 rounded-full text-xs ".concat(new Date(e.event_date)>new Date?"bg-green-100 text-green-800":"bg-slate-100 text-slate-800"),children:new Date(e.event_date)>new Date?"Upcoming":"Past"}),e.is_private&&(0,a.jsx)("span",{className:"ml-1 px-2 py-1 rounded-full text-xs bg-orange-100 text-orange-800",children:"Private"})]}),(0,a.jsx)("td",{className:"py-3 px-2",children:(0,a.jsx)("button",{onClick:()=>k(e.id,e.title),className:"text-red-600 hover:text-red-800 font-medium text-xs",children:"Delete"})})]},e.id))})]})})]}),c.length>0&&(0,a.jsxs)("div",{className:"bg-white rounded-xl shadow-soft p-6 border border-slate-200 mb-8",children:[(0,a.jsxs)("h2",{className:"text-xl font-semibold text-slate-800 mb-4",children:["\uD83D\uDCCB All Events (",S.length," ","all"!==y?"of ".concat(c.length):"",")"]}),(0,a.jsx)("div",{className:"overflow-x-auto",children:(0,a.jsxs)("table",{className:"w-full text-sm",children:[(0,a.jsx)("thead",{children:(0,a.jsxs)("tr",{className:"border-b border-slate-200",children:[(0,a.jsx)("th",{className:"text-left py-3 px-2",children:"ID"}),(0,a.jsx)("th",{className:"text-left py-3 px-2",children:"Title"}),(0,a.jsx)("th",{className:"text-left py-3 px-2",children:"Host"}),(0,a.jsx)("th",{className:"text-left py-3 px-2",children:"Category"}),(0,a.jsx)("th",{className:"text-left py-3 px-2",children:"Date"}),(0,a.jsx)("th",{className:"text-left py-3 px-2",children:"Attendees"}),(0,a.jsx)("th",{className:"text-left py-3 px-2",children:"Price"}),(0,a.jsx)("th",{className:"text-left py-3 px-2",children:"Status"}),(0,a.jsx)("th",{className:"text-left py-3 px-2",children:"Actions"})]})}),(0,a.jsx)("tbody",{children:S.map(e=>{var t;return(0,a.jsxs)("tr",{className:"border-b border-slate-100 hover:bg-slate-50",children:[(0,a.jsx)("td",{className:"py-3 px-2 font-mono text-xs",children:e.id}),(0,a.jsxs)("td",{className:"py-3 px-2",children:[(0,a.jsx)("div",{className:"font-medium",children:e.title}),(0,a.jsx)("div",{className:"text-xs text-slate-500 truncate max-w-xs",children:e.description})]}),(0,a.jsxs)("td",{className:"py-3 px-2",children:[e.host_name||(0,a.jsx)("span",{className:"text-red-600 font-medium",children:"Orphaned"}),e.host_username&&(0,a.jsxs)("div",{className:"text-xs text-slate-500",children:["@",e.host_username]}),e.host_id&&(0,a.jsxs)("div",{className:"text-xs text-slate-400",children:["ID: ",e.host_id]})]}),(0,a.jsx)("td",{className:"py-3 px-2",children:(0,a.jsx)("span",{className:"px-2 py-1 rounded-full text-xs bg-blue-100 text-blue-800",children:e.category})}),(0,a.jsxs)("td",{className:"py-3 px-2",children:[(0,a.jsx)("div",{className:"text-sm",children:T(e.event_date)}),(0,a.jsxs)("div",{className:"text-xs text-slate-500",children:[e.start_time," - ",e.end_time]})]}),(0,a.jsxs)("td",{className:"py-3 px-2",children:[e.current_attendees||0," / ",e.max_attendees||"Unlimited"]}),(0,a.jsx)("td",{className:"py-3 px-2",children:(t=e.price_cents)&&0!==t?"$".concat((t/100).toFixed(2)):"Free"}),(0,a.jsx)("td",{className:"py-3 px-2",children:(0,a.jsxs)("div",{className:"flex flex-col gap-1",children:[(0,a.jsx)("span",{className:"px-2 py-1 rounded-full text-xs ".concat(new Date(e.event_date)>new Date?"bg-green-100 text-green-800":"bg-slate-100 text-slate-800"),children:new Date(e.event_date)>new Date?"Upcoming":"Past"}),e.is_private&&(0,a.jsx)("span",{className:"px-2 py-1 rounded-full text-xs bg-orange-100 text-orange-800",children:"Private"}),(!e.host_id||!e.host_name)&&(0,a.jsx)("span",{className:"px-2 py-1 rounded-full text-xs bg-red-100 text-red-800",children:"Orphaned"})]})}),(0,a.jsx)("td",{className:"py-3 px-2",children:(0,a.jsx)("button",{onClick:()=>k(e.id,e.title),className:"text-red-600 hover:text-red-800 font-medium text-xs",children:"Delete"})})]},e.id)})})]})})]}),g.length>0&&(0,a.jsxs)("div",{className:"bg-white rounded-xl shadow-soft p-6 border border-slate-200",children:[(0,a.jsx)("h2",{className:"text-xl font-semibold text-slate-800 mb-4",children:"\uD83D\uDCDD Activity Log"}),(0,a.jsx)("div",{className:"bg-slate-900 text-slate-100 rounded-lg p-4 max-h-64 overflow-y-auto",children:(0,a.jsx)("div",{className:"text-sm font-mono",dangerouslySetInnerHTML:{__html:g.join("")}})})]})]})})}):(0,a.jsx)(r.default,{children:(0,a.jsx)("div",{className:"min-h-screen bg-gradient-to-br from-slate-50 to-blue-50 flex items-center justify-center",children:(0,a.jsxs)("div",{className:"bg-white rounded-xl shadow-soft p-8 border border-slate-200 text-center max-w-md",children:[(0,a.jsx)("div",{className:"w-16 h-16 bg-red-100 rounded-full flex items-center justify-center mx-auto mb-4",children:(0,a.jsx)("span",{className:"text-red-600 text-2xl",children:"\uD83D\uDD10"})}),(0,a.jsx)("h1",{className:"text-2xl font-bold text-slate-800 mb-2",children:"Access Denied"}),(0,a.jsxs)("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4 mb-4",children:[(0,a.jsx)("p",{className:"text-red-800 font-medium mb-2",children:"⚠️ Admin Access Required"}),(0,a.jsx)("p",{className:"text-red-700 text-sm",children:"You don't have permission to access this page."}),(0,a.jsx)("p",{className:"text-red-600 text-sm mt-2",children:"Redirecting to home page in 3 seconds..."})]}),g.length>0&&(0,a.jsx)("div",{className:"bg-slate-100 rounded-lg p-4 max-h-32 overflow-y-auto",children:(0,a.jsx)("div",{className:"text-sm text-left",dangerouslySetInnerHTML:{__html:g.join("")}})})]})})})}}},e=>{e.O(0,[4684,4236,3238,8441,5964,7358],()=>e(e.s=4415)),_N_E=e.O()}]);