(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[9566],{184:(e,t,a)=>{"use strict";a.d(t,{A:()=>r});var s=a(2115);let r=s.forwardRef(function(e,t){let{title:a,titleId:r,...n}=e;return s.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:t,"aria-labelledby":r},n),a?s.createElement("title",{id:r},a):null,s.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M2.036 12.322a1.012 1.012 0 0 1 0-.639C3.423 7.51 7.36 4.5 12 4.5c4.638 0 8.573 3.007 9.963 7.178.07.207.07.431 0 .639C20.577 16.49 16.64 19.5 12 19.5c-4.638 0-8.573-3.007-9.963-7.178Z"}),s.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15 12a3 3 0 1 1-6 0 3 3 0 0 1 6 0Z"}))})},2151:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>m});var s=a(5155),r=a(2115),n=a(5695),o=a(3238),l=a(4236),i=a(9337),c=a(2119),d=a(8987),u=a(184);function m(){let e=(0,n.useRouter)(),{authState:t,isLoading:a}=(0,l.A)(),[m,h]=(0,r.useState)(null),[x,p]=(0,r.useState)(""),[b,f]=(0,r.useState)(""),[g,N]=(0,r.useState)(""),[v,j]=(0,r.useState)(""),[y,w]=(0,r.useState)(""),[O,k]=(0,r.useState)(""),[D,A]=(0,r.useState)(!1),[R,B]=(0,r.useState)(!1),[S,E]=(0,r.useState)(!1),[C,G]=(0,r.useState)(null),[I,U]=(0,r.useState)(!1),[P,_]=(0,r.useState)("loading"),[L,T]=(0,r.useState)(null),[M,F]=(0,r.useState)(null);console.log("\uD83D\uDD0D ONBOARDING DEBUG: Component rendered, step:",P),console.log("\uD83D\uDD0D ONBOARDING DEBUG: Auth loading:",a),console.log("\uD83D\uDD0D ONBOARDING DEBUG: Auth state:",t),console.log("\uD83D\uDD0D ONBOARDING DEBUG: AuthUser state:",m),(0,r.useEffect)(()=>{if(console.log("\uD83D\uDD0D ONBOARDING DEBUG: useEffect triggered"),console.log("\uD83D\uDD0D ONBOARDING DEBUG: Auth state:",t),!a){if(!t.isAuthenticated){console.log("\uD83D\uDD0D ONBOARDING DEBUG: User not authenticated, redirecting to signin"),e.push("/signin");return}if(!t.needsOnboarding)if("backend"===t.authMethod){console.log("\uD83D\uDD0D ONBOARDING DEBUG: Backend user already onboarded, redirecting to profile"),e.push("/profile");return}else console.log("\uD83D\uDD0D ONBOARDING DEBUG: Auth0 user - showing onboarding for potential account linking");console.log("\uD83D\uDD0D ONBOARDING DEBUG: User needs onboarding, proceeding to profile step"),h(t.user),_("profile")}},[a,t,e]),(0,r.useEffect)(()=>()=>{L&&clearTimeout(L)},[L]);let q=async e=>{if(!e||e.length<3)return void G("invalid");let t=e.replace("@","");if(!/^[a-zA-Z0-9_]{3,20}$/.test(t))return void G("invalid");E(!0),G(null);try{let e=await fetch("".concat("https://coral-app-tjel2.ondigitalocean.app","/api/v1/users/check-username?username=").concat(encodeURIComponent(t)));if(e.ok){let t=await e.json();G(t.available?"available":"taken")}else["admin","scoop","user","test","grant","john","jane"].includes(t.toLowerCase())?G("taken"):G("available")}catch(e){console.error("Error checking username availability:",e),["admin","scoop","user","test","grant","john","jane"].includes(t.toLowerCase())?G("taken"):G("available")}finally{E(!1)}},Y=()=>{let e=x.length>=3&&/^[a-zA-Z0-9_]{3,20}$/.test(x.replace("@","")),t=b.trim().length>0,a=g.trim().length>0,s=v.trim().length>0,r=(null==m?void 0:m.sub)||y.trim()&&y===O&&y.length>=8,n="available"===C||null===C&&e;return e&&t&&a&&s&&r&&n},J=async()=>{console.log("\uD83D\uDD0D ONBOARDING DEBUG: Create profile button clicked"),console.log("\uD83D\uDD0D ONBOARDING DEBUG: Form validation:",{formValid:Y(),hasAuthUser:!!m,username:x,firstName:b,lastName:g,phone:v,usernameStatus:C}),console.log("\uD83D\uDD0D ONBOARDING DEBUG: AuthState user:",t.user);let a=m||t.user;if(!Y()||!a)return void console.error("\uD83D\uDD0D ONBOARDING ERROR: Cannot create profile - invalid state:",{formValid:Y(),hasAuthUser:!!m,hasAuthStateUser:!!t.user,userToUse:!!a,username:x,firstName:b,lastName:g,phone:v,usernameStatus:C});U(!0),console.log("\uD83D\uDD0D ONBOARDING DEBUG: Starting profile creation...");try{let t,s=x.replace("@",""),r="".concat(b.trim()," ").concat(g.trim()).trim();if(!v.trim())throw Error("Phone number is required");let n=v.trim();if(a.sub)try{let e=await fetch("".concat("https://coral-app-tjel2.ondigitalocean.app","/api/v1/users"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({auth0UserId:a.sub,email:a.email,name:r||a.name,avatar:a.picture,username:s,phone:n})});if(!e.ok){let t=await e.text();throw console.error("\uD83D\uDD0D ONBOARDING ERROR: Backend returned error:",t),Error("Failed to create user: ".concat(e.status," - ").concat(t))}if(!(t=(await e.json()).user).phone)throw console.error("\uD83D\uDD0D ONBOARDING ERROR: Phone not saved in backend response"),Error("Phone number was not saved to backend")}catch(e){console.error("\uD83D\uDD0D ONBOARDING ERROR: Backend API failed, using fallback:",e),t={id:"auth0_".concat(Date.now()),auth0UserId:a.sub,email:a.email,name:r||a.name,avatar_url:a.picture,username:s,phone:n,trust_score:50,created_at:new Date().toISOString()}}else try{let e=await fetch("".concat("https://coral-app-tjel2.ondigitalocean.app","/api/v1/users/").concat(a.id),{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({username:s,phone:n,name:r||a.name})});if(!e.ok){let t=await e.text();throw console.error("\uD83D\uDD0D ONBOARDING ERROR: Backend update failed:",t),Error("Failed to update user: ".concat(e.status," - ").concat(t))}if(!(t=(await e.json()).user).phone)throw console.error("\uD83D\uDD0D ONBOARDING ERROR: Phone not saved in backend response"),Error("Phone number was not saved to backend")}catch(e){console.error("\uD83D\uDD0D ONBOARDING ERROR: Backend update failed, using fallback:",e),t={...a,username:s,phone:n,name:r||a.name}}let o={id:t.id,scoopUserId:t.id,name:t.name,email:t.email,username:t.username,phone:t.phone,avatar_url:t.avatar_url,trust_score:t.trust_score},l={user:o,expiresAt:Date.now()+864e5,authMethod:a.sub?"auth0":"backend"};console.log("\uD83D\uDD0D ONBOARDING DEBUG: Session data being set:",{user:o,expiresAt:l.expiresAt,authMethod:l.authMethod,hasCompleteProfile:!!(o.scoopUserId&&o.username&&o.phone)});try{if((await fetch("/api/auth/update-session",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(l)})).ok)console.log("Session updated successfully via API");else{console.error("Failed to update session via API, using fallback");let e=encodeURIComponent(JSON.stringify(l));document.cookie="appSession=".concat(e,"; ").concat("path=/; max-age=".concat(86400,"; SameSite=Lax"))}}catch(t){console.error("Failed to update session via API, using fallback:",t);let e=encodeURIComponent(JSON.stringify(l));document.cookie="appSession=".concat(e,"; ").concat("path=/; max-age=".concat(86400,"; SameSite=Lax"))}try{let e="token_".concat(Date.now(),"_").concat(Math.random().toString(36).substr(2,9));await fetch("/api/auth/sync",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({user:o,authToken:e})}),console.log("\uD83D\uDD0D ONBOARDING: Auth sync successful")}catch(t){console.error("Failed to sync auth state:",t);let e=encodeURIComponent(JSON.stringify(o));document.cookie="user=".concat(e,"; ").concat("path=/; max-age=".concat(86400,"; SameSite=Lax")),console.log("\uD83D\uDD0D ONBOARDING: Fallback cookie setting completed")}console.log("\uD83D\uDD0D ONBOARDING DEBUG: Profile creation completed successfully"),_("complete"),setTimeout(()=>{console.log("\uD83D\uDD0D ONBOARDING DEBUG: Redirecting to profile page"),e.push("/profile")},2e3)}catch(e){console.error("Error creating profile:",e),U(!1)}},W=()=>{var e;return(null==m?void 0:m.sub)?(e=m.sub).startsWith("linkedin|")?"LinkedIn":e.startsWith("google-oauth2|")?"Google":e.startsWith("facebook|")?"Facebook":"Unknown":"backend account"};return"loading"===P?(0,s.jsx)(o.default,{children:(0,s.jsx)("div",{className:"flex items-center justify-center min-h-[60vh]",children:(0,s.jsxs)("div",{className:"text-center",children:[(0,s.jsx)("div",{className:"w-8 h-8 border-2 border-cyan-500 border-t-transparent rounded-full animate-spin mx-auto mb-4"}),(0,s.jsx)("p",{className:"text-slate-600",children:"Setting up your account..."})]})})}):"complete"===P?(0,s.jsx)(o.default,{children:(0,s.jsx)("div",{className:"flex items-center justify-center min-h-[60vh]",children:(0,s.jsxs)("div",{className:"text-center max-w-md",children:[(0,s.jsx)("div",{className:"w-16 h-16 bg-green-100 rounded-full flex items-center justify-center mx-auto mb-4",children:(0,s.jsx)(i.A,{className:"w-8 h-8 text-green-600"})}),(0,s.jsx)("h1",{className:"text-2xl font-bold text-slate-800 mb-2",children:"Welcome to Scoop!"}),(0,s.jsx)("p",{className:"text-slate-600 mb-4",children:"Your profile has been created successfully. You're now part of the ScoopSocials community!"}),(0,s.jsx)("div",{className:"bg-cyan-50 border border-cyan-200 rounded-xl p-4",children:(0,s.jsxs)("p",{className:"text-sm text-cyan-800",children:[(0,s.jsxs)("strong",{children:["@",x.replace("@","")]})," is now your Scoop username"]})})]})})}):"profile"===P?(0,s.jsx)(o.default,{children:(0,s.jsxs)("div",{className:"max-w-2xl mx-auto p-4 md:p-6",children:[(0,s.jsxs)("div",{className:"text-center mb-8",children:[(0,s.jsx)("div",{className:"w-16 h-16 bg-gradient-to-r from-cyan-500 to-teal-600 rounded-2xl flex items-center justify-center mx-auto mb-4 shadow-lg",children:(0,s.jsx)("span",{className:"text-white text-2xl",children:"\uD83C\uDF66"})}),(0,s.jsx)("h1",{className:"text-3xl font-bold text-slate-800 mb-2",children:"Complete Your Profile"}),(0,s.jsx)("p",{className:"text-slate-600",children:(null==m?void 0:m.sub)?"Great! You've connected your ".concat(W()," account. Now let's complete your profile with a few more details."):"Great! You've created your account. Now let's complete your profile with a few more details."})]}),(0,s.jsx)("div",{className:"bg-green-50 border border-green-200 rounded-xl p-4 mb-6",children:(0,s.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,s.jsx)("div",{className:"w-12 h-12 rounded-xl overflow-hidden bg-gradient-to-r from-cyan-500 to-teal-600 flex items-center justify-center",children:(null==m?void 0:m.picture)||(null==m?void 0:m.avatar_url)?(0,s.jsx)("img",{src:m.picture||m.avatar_url,alt:"Profile",className:"w-full h-full object-cover"}):(0,s.jsx)("span",{className:"text-white text-xl",children:"\uD83D\uDC64"})}),(0,s.jsxs)("div",{children:[(0,s.jsx)("h3",{className:"font-medium text-slate-800",children:null==m?void 0:m.name}),(0,s.jsxs)("p",{className:"text-sm text-green-700",children:["✅ ",(null==m?void 0:m.sub)?"".concat(W()," Connected"):"Account Created"]})]})]})}),(0,s.jsxs)("div",{className:"bg-white rounded-2xl border border-slate-200 shadow-lg p-6",children:[(0,s.jsx)("h2",{className:"text-xl font-semibold text-slate-800 mb-4",children:"Complete Your Profile"}),(0,s.jsxs)("div",{className:"space-y-4",children:[(0,s.jsxs)("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"First Name"}),(0,s.jsx)("input",{type:"text",value:b,onChange:e=>f(e.target.value),placeholder:"John",className:"w-full px-4 py-3 rounded-xl border border-slate-200 bg-white focus:border-cyan-500 focus:ring-2 focus:ring-cyan-200 transition-all duration-200",required:!0})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Last Name"}),(0,s.jsx)("input",{type:"text",value:g,onChange:e=>N(e.target.value),placeholder:"Doe",className:"w-full px-4 py-3 rounded-xl border border-slate-200 bg-white focus:border-cyan-500 focus:ring-2 focus:ring-cyan-200 transition-all duration-200",required:!0})]})]}),(0,s.jsx)("p",{className:"text-xs text-slate-600 mt-1",children:"This will be your display name on your profile"}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Your Scoop Username"}),(0,s.jsxs)("div",{className:"relative",children:[(0,s.jsx)("span",{className:"absolute left-3 top-3 text-slate-500",children:"@"}),(0,s.jsx)("input",{type:"text",value:x,onChange:e=>{let t=e.target.value;p(t),G(null),L&&clearTimeout(L),t.trim()&&T(setTimeout(()=>{q(t)},300))},placeholder:"your_username",className:"w-full pl-8 pr-12 py-3 rounded-xl border transition-all duration-200 ".concat("available"===C?"border-green-500 bg-green-50":"taken"===C||"invalid"===C?"border-red-500 bg-red-50":"border-slate-200 bg-white focus:border-cyan-500 focus:ring-2 focus:ring-cyan-200")}),(0,s.jsxs)("div",{className:"absolute right-3 top-3",children:[S&&(0,s.jsx)("div",{className:"w-5 h-5 border-2 border-slate-300 border-t-cyan-500 rounded-full animate-spin"}),"available"===C&&(0,s.jsx)(i.A,{className:"w-5 h-5 text-green-500"}),("taken"===C||"invalid"===C)&&(0,s.jsx)(c.A,{className:"w-5 h-5 text-red-500"})]})]}),"available"===C&&(0,s.jsxs)("p",{className:"text-sm text-green-600 mt-2",children:["✅ @",x.replace("@","")," is available!"]}),"taken"===C&&(0,s.jsx)("p",{className:"text-sm text-red-600 mt-2",children:"❌ This username is already taken"}),"invalid"===C&&(0,s.jsx)("p",{className:"text-sm text-red-600 mt-2",children:"❌ Username must be 3-20 characters (letters, numbers, underscore only)"}),null===C&&x.length>=3&&/^[a-zA-Z0-9_]{3,20}$/.test(x.replace("@",""))&&(0,s.jsxs)("p",{className:"text-sm text-green-600 mt-2",children:["✅ @",x.replace("@","")," looks available!"]})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"\uD83D\uDCF1 Phone Number"}),(0,s.jsx)("input",{type:"tel",value:v,onChange:e=>j(e.target.value),placeholder:"+1 (555) 123-4567",className:"w-full px-4 py-3 rounded-xl border border-slate-200 bg-white focus:border-cyan-500 focus:ring-2 focus:ring-cyan-200 transition-all duration-200",required:!0}),(0,s.jsx)("p",{className:"text-xs text-slate-600 mt-1",children:"Required for account security and verification"})]}),!(null==m?void 0:m.sub)&&(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"\uD83D\uDD12 Password"}),(0,s.jsxs)("div",{className:"relative",children:[(0,s.jsx)("input",{type:D?"text":"password",value:y,onChange:e=>w(e.target.value),placeholder:"••••••••••••••",className:"w-full px-4 py-3 pr-12 rounded-xl border border-slate-200 bg-white focus:border-cyan-500 focus:ring-2 focus:ring-cyan-200 transition-all duration-200",required:!0}),(0,s.jsx)("button",{type:"button",onClick:()=>A(!D),className:"absolute right-3 top-3 text-slate-400 hover:text-slate-600 transition-colors duration-200",children:D?(0,s.jsx)(d.A,{className:"w-5 h-5"}):(0,s.jsx)(u.A,{className:"w-5 h-5"})})]}),(0,s.jsx)("p",{className:"text-xs text-slate-600 mt-1",children:"Minimum 8 characters"})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"\uD83D\uDD12 Confirm Password"}),(0,s.jsxs)("div",{className:"relative",children:[(0,s.jsx)("input",{type:R?"text":"password",value:O,onChange:e=>k(e.target.value),placeholder:"••••••••••••••",className:"w-full px-4 py-3 pr-12 rounded-xl border border-slate-200 bg-white focus:border-cyan-500 focus:ring-2 focus:ring-cyan-200 transition-all duration-200",required:!0}),(0,s.jsx)("button",{type:"button",onClick:()=>B(!R),className:"absolute right-3 top-3 text-slate-400 hover:text-slate-600 transition-colors duration-200",children:R?(0,s.jsx)(d.A,{className:"w-5 h-5"}):(0,s.jsx)(u.A,{className:"w-5 h-5"})})]}),y!==O&&O&&(0,s.jsx)("p",{className:"text-xs text-red-600 mt-1",children:"❌ Passwords do not match"})]})]}),(0,s.jsxs)("div",{className:"bg-slate-50 rounded-xl p-4",children:[(0,s.jsx)("h4",{className:"text-sm font-medium text-slate-800 mb-2",children:"Username Requirements:"}),(0,s.jsxs)("ul",{className:"text-xs text-slate-600 space-y-1",children:[(0,s.jsx)("li",{children:"• 3-20 characters long"}),(0,s.jsx)("li",{children:"• Letters, numbers, and underscores only"}),(0,s.jsx)("li",{children:"• Must be unique across ScoopSocials"}),(0,s.jsx)("li",{children:"• Cannot be changed later"})]})]}),(0,s.jsx)("button",{onClick:J,disabled:!Y()||I,className:"w-full py-3 rounded-xl font-medium transition-all duration-200 ".concat(Y()&&!I?"bg-gradient-to-r from-cyan-500 to-teal-600 text-white hover:from-cyan-600 hover:to-teal-700 shadow-lg":"bg-slate-200 text-slate-500 cursor-not-allowed"),children:I?(0,s.jsxs)("div",{className:"flex items-center justify-center space-x-2",children:[(0,s.jsx)("div",{className:"w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin"}),(0,s.jsx)("span",{children:"Creating Profile..."})]}):"Create My Scoop Profile"}),(null==m?void 0:m.sub)&&(0,s.jsx)("div",{className:"text-center mt-4",children:(0,s.jsx)("button",{onClick:()=>e.push("/phone-verification"),className:"text-sm text-cyan-600 hover:text-cyan-700 underline",children:"Already have an account? Sign in with phone number"})})]})]}),(0,s.jsxs)("div",{className:"bg-cyan-50 border border-cyan-200 rounded-xl p-4 mt-6",children:[(0,s.jsx)("h3",{className:"text-sm font-semibold text-cyan-800 mb-2",children:"\uD83D\uDEE1️ Building Your Trust Score"}),(0,s.jsx)("p",{className:"text-xs text-cyan-700 mb-2",children:"You've started with 50 points! Complete your profile to increase your trust score."}),(0,s.jsxs)("p",{className:"text-xs text-cyan-600",children:["\uD83D\uDCA1 ",(0,s.jsx)("strong",{children:"Pro Tip:"})," Connect social accounts and attend events to maximize your trust score."]})]})]})}):(0,s.jsx)(o.default,{children:(0,s.jsx)("div",{className:"flex items-center justify-center min-h-[60vh]",children:(0,s.jsxs)("div",{className:"text-center",children:[(0,s.jsx)("div",{className:"w-8 h-8 border-2 border-cyan-500 border-t-transparent rounded-full animate-spin mx-auto mb-4"}),(0,s.jsx)("p",{className:"text-slate-600",children:"Loading..."})]})})})}},7957:(e,t,a)=>{Promise.resolve().then(a.bind(a,2151))},8987:(e,t,a)=>{"use strict";a.d(t,{A:()=>r});var s=a(2115);let r=s.forwardRef(function(e,t){let{title:a,titleId:r,...n}=e;return s.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:t,"aria-labelledby":r},n),a?s.createElement("title",{id:r},a):null,s.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M3.98 8.223A10.477 10.477 0 0 0 1.934 12C3.226 16.338 7.244 19.5 12 19.5c.993 0 1.953-.138 2.863-.395M6.228 6.228A10.451 10.451 0 0 1 12 4.5c4.756 0 8.773 3.162 10.065 7.498a10.522 10.522 0 0 1-4.293 5.774M6.228 6.228 3 3m3.228 3.228 3.65 3.65m7.894 7.894L21 21m-3.228-3.228-3.65-3.65m0 0a3 3 0 1 0-4.243-4.243m4.242 4.242L9.88 9.88"}))})},9337:(e,t,a)=>{"use strict";a.d(t,{A:()=>r});var s=a(2115);let r=s.forwardRef(function(e,t){let{title:a,titleId:r,...n}=e;return s.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:t,"aria-labelledby":r},n),a?s.createElement("title",{id:r},a):null,s.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"m4.5 12.75 6 6 9-13.5"}))})}},e=>{e.O(0,[4684,4236,3238,8441,5964,7358],()=>e(e.s=7957)),_N_E=e.O()}]);