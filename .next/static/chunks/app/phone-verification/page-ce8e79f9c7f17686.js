(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[1671],{2461:(e,t,s)=>{"use strict";s.d(t,{A:()=>n});var o=s(2115);let n=o.forwardRef(function(e,t){let{title:s,titleId:n,...a}=e;return o.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:t,"aria-labelledby":n},a),s?o.createElement("title",{id:n},s):null,o.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M10.5 19.5 3 12m0 0 7.5-7.5M3 12h18"}))})},5695:(e,t,s)=>{"use strict";var o=s(8999);s.o(o,"useParams")&&s.d(t,{useParams:function(){return o.useParams}}),s.o(o,"usePathname")&&s.d(t,{usePathname:function(){return o.usePathname}}),s.o(o,"useRouter")&&s.d(t,{useRouter:function(){return o.useRouter}}),s.o(o,"useSearchParams")&&s.d(t,{useSearchParams:function(){return o.useSearchParams}})},8818:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>r});var o=s(5155),n=s(2115),a=s(5695),i=s(2461);function r(){let e=(0,a.useRouter)(),[t,s]=(0,n.useState)("loading"),[r,l]=(0,n.useState)(""),[c,d]=(0,n.useState)(""),[u,h]=(0,n.useState)(!1),[m,x]=(0,n.useState)(!1),[p,g]=(0,n.useState)(""),[f,b]=(0,n.useState)("");(0,n.useEffect)(()=>{let t=async()=>{try{console.log("\uD83D\uDD0D PHONE VERIFICATION: Checking authentication status...");let t=await fetch("/api/auth/status"),o=await t.json();console.log("\uD83D\uDD0D PHONE VERIFICATION: Auth status response:",o);let n=document.cookie.includes("authToken")||document.cookie.includes("appSession")||document.cookie.includes("user");if(console.log("\uD83D\uDD0D PHONE VERIFICATION: Cookie check:",{hasAuthCookies:n,cookies:document.cookie}),o.isAuthenticated&&o.user)console.log("\uD83D\uDD0D PHONE VERIFICATION: User is authenticated, allowing access"),console.log("\uD83D\uDD0D PHONE VERIFICATION: User data:",o.user),o.user.phone?(l(o.user.phone),console.log("\uD83D\uDD0D PHONE VERIFICATION: Pre-filled phone number:",o.user.phone),o.user.phone?(console.log("\uD83D\uDD0D PHONE VERIFICATION: Phone pre-filled, skipping to code step"),s("code")):s("phone")):(console.log("\uD83D\uDD0D PHONE VERIFICATION: No phone number in user data, staying on phone step"),s("phone"));else if(n){console.log("\uD83D\uDD0D PHONE VERIFICATION: Auth cookies found but state not updated, allowing access"),console.log("\uD83D\uDD0D PHONE VERIFICATION: This is likely a user coming from onboarding or signup"),s("phone");let e=new URLSearchParams(window.location.search);"signup"===e.get("from")&&console.log("\uD83D\uDD0D PHONE VERIFICATION: Coming from signup, staying on phone step for verification")}else console.log("\uD83D\uDD0D PHONE VERIFICATION: No authentication found, redirecting to signin"),console.log("\uD83D\uDD0D PHONE VERIFICATION: Auth status details:",{isAuthenticated:o.isAuthenticated,hasUser:!!o.user,authMethod:o.authMethod,hasSessionCookie:o.hasSessionCookie,hasUserCookie:o.hasUserCookie,hasAuthToken:o.hasAuthToken}),e.push("/signin")}catch(t){console.error("\uD83D\uDD0D PHONE VERIFICATION: Auth check error:",t),e.push("/signin")}};setTimeout(()=>{t()},500)},[e]);let N=async()=>{if(!r.trim())return void g("Please enter your phone number");h(!0),g("");try{let e=await fetch("/api/auth/send-code",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({phone:r.trim()})}),t=await e.json();t.success?(b("Verification code sent to your phone number"),s("code")):g(t.message||"Failed to send verification code")}catch(e){console.error("Error sending verification code:",e),g("Failed to send verification code. Please try again.")}finally{h(!1)}},y=async()=>{if(!c.trim()||6!==c.length)return void g("Please enter the 6-digit verification code");x(!0),g("");try{let t=await fetch("/api/auth/status"),s=await t.json();if(s.isAuthenticated&&s.user)if("auth0"===s.authMethod){console.log("\uD83D\uDD0D PHONE VERIFICATION: Verifying Auth0 social login user");let t=await fetch("/api/auth/verify-phone-find-account",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({phoneNumber:r.trim(),verificationCode:c.trim()})}),s=await t.json();s.success?(b("Account found! Linking your Auth0 account..."),await j(s.user),setTimeout(()=>{e.push("/profile")},2e3)):g(s.message||"Invalid verification code or no account found")}else{console.log("\uD83D\uDD0D PHONE VERIFICATION: Verifying direct signup user");let t=await fetch("/api/auth/verify-code",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({phone:r.trim(),code:c.trim()})}),s=await t.json();s.success?(b("Phone number verified successfully! Redirecting to home..."),setTimeout(async()=>{try{let t=await fetch("/api/auth/status"),s=await t.json();console.log("\uD83D\uDD0D PHONE VERIFICATION: Auth status before redirect:",s),s.isAuthenticated?e.push("/"):(console.log("\uD83D\uDD0D PHONE VERIFICATION: Auth not confirmed, staying on verification page"),g("Authentication not confirmed. Please try again."))}catch(t){console.error("\uD83D\uDD0D PHONE VERIFICATION: Error checking auth status:",t),e.push("/")}},1500)):g(s.message||"Invalid verification code")}else{let t=new URLSearchParams(window.location.search);if("signup"===t.get("from")){console.log("\uD83D\uDD0D PHONE VERIFICATION: Coming from signup, proceeding without auth check");let t=await fetch("/api/auth/verify-code",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({phone:r.trim(),code:c.trim()})}),s=await t.json();s.success?(b("Phone number verified successfully! Redirecting to home..."),setTimeout(async()=>{e.push("/")},1500)):g(s.message||"Invalid verification code")}else g("No authentication found. Please sign up or sign in first.")}}catch(e){console.error("Error verifying code:",e),g("Failed to verify code. Please try again.")}finally{x(!1)}},j=async e=>{try{let t=localStorage.getItem("auth0User");if(!t)return;let s=JSON.parse(t),o=await fetch("/api/auth/link-auth0-account",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({existingUserId:e.id,auth0UserId:s.sub,auth0UserData:s})});(await o.json()).success&&localStorage.removeItem("auth0User")}catch(e){console.error("Error linking Auth0 account:",e)}};return"loading"===t?(0,o.jsx)("div",{className:"min-h-screen bg-gradient-to-br from-cyan-50 via-blue-50 to-teal-50 relative",children:(0,o.jsx)("div",{className:"flex items-center justify-center min-h-[60vh]",children:(0,o.jsxs)("div",{className:"text-center",children:[(0,o.jsx)("div",{className:"w-8 h-8 border-2 border-cyan-500 border-t-transparent rounded-full animate-spin mx-auto mb-4"}),(0,o.jsx)("p",{className:"text-slate-600",children:"Processing..."})]})})}):(0,o.jsxs)("div",{className:"min-h-screen bg-gradient-to-br from-cyan-50 via-blue-50 to-teal-50 relative",children:[(0,o.jsxs)("div",{className:"max-w-md mx-auto p-4 md:p-6",children:[(0,o.jsxs)("div",{className:"text-center mb-8",children:[(0,o.jsx)("button",{onClick:()=>{e.push("/onboarding")},className:"absolute left-4 top-4 text-slate-600 hover:text-slate-800",children:(0,o.jsx)(i.A,{className:"w-6 h-6"})}),(0,o.jsx)("div",{className:"w-16 h-16 bg-gradient-to-r from-cyan-500 to-teal-600 rounded-2xl flex items-center justify-center mx-auto mb-4 shadow-lg",children:(0,o.jsx)("span",{className:"text-white text-2xl",children:"\uD83D\uDCF1"})}),(0,o.jsx)("h1",{className:"text-3xl font-bold text-slate-800 mb-2",children:"phone"===t?"Verify Your Phone":"Enter Verification Code"}),(0,o.jsx)("p",{className:"text-slate-600",children:"phone"===t?"Enter your phone number to receive a verification code":"Enter the 6-digit code sent to your phone"})]}),p&&(0,o.jsx)("div",{className:"bg-red-50 border border-red-200 rounded-xl p-4 mb-6",children:(0,o.jsx)("p",{className:"text-red-700 text-sm",children:p})}),f&&(0,o.jsx)("div",{className:"bg-green-50 border border-green-200 rounded-xl p-4 mb-6",children:(0,o.jsx)("p",{className:"text-green-700 text-sm",children:f})}),"phone"===t&&(0,o.jsx)("div",{className:"bg-white rounded-2xl border border-slate-200 shadow-lg p-6",children:(0,o.jsxs)("div",{className:"space-y-4",children:[(0,o.jsxs)("div",{children:[(0,o.jsx)("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"\uD83D\uDCF1 Phone Number"}),(0,o.jsx)("input",{type:"tel",value:r,onChange:e=>l(e.target.value),placeholder:"+1 (555) 123-4567",className:"w-full px-4 py-3 rounded-xl border border-slate-200 bg-white focus:border-cyan-500 focus:ring-2 focus:ring-cyan-200 transition-all duration-200"}),(0,o.jsx)("p",{className:"text-xs text-slate-600 mt-1",children:"We'll send a verification code to this number"})]}),(0,o.jsx)("button",{onClick:N,disabled:u||!r.trim(),className:"w-full py-3 rounded-xl font-medium transition-all duration-200 ".concat(!u&&r.trim()?"bg-gradient-to-r from-cyan-500 to-teal-600 text-white hover:from-cyan-600 hover:to-teal-700 shadow-lg":"bg-slate-200 text-slate-500 cursor-not-allowed"),children:u?(0,o.jsxs)("div",{className:"flex items-center justify-center space-x-2",children:[(0,o.jsx)("div",{className:"w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin"}),(0,o.jsx)("span",{children:"Sending Code..."})]}):"Send Verification Code"})]})}),"code"===t&&(0,o.jsx)("div",{className:"bg-white rounded-2xl border border-slate-200 shadow-lg p-6",children:(0,o.jsxs)("div",{className:"space-y-4",children:[(0,o.jsxs)("div",{children:[(0,o.jsx)("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"\uD83D\uDD10 Verification Code"}),(0,o.jsx)("input",{type:"text",value:c,onChange:e=>d(e.target.value.replace(/\D/g,"").slice(0,6)),placeholder:"123456",maxLength:6,className:"w-full px-4 py-3 text-center text-2xl font-mono rounded-xl border border-slate-200 bg-white focus:border-cyan-500 focus:ring-2 focus:ring-cyan-200 transition-all duration-200"}),(0,o.jsxs)("p",{className:"text-xs text-slate-600 mt-1 text-center",children:["Enter the 6-digit code sent to ",r]}),(0,o.jsxs)("div",{className:"bg-yellow-50 border border-yellow-200 rounded-lg p-3 mt-2",children:[(0,o.jsxs)("p",{className:"text-xs text-yellow-800 font-medium mb-2",children:["\uD83D\uDEA7 ",(0,o.jsx)("strong",{children:"TEST MODE - Hardcoded Verification Codes:"})]}),(0,o.jsxs)("div",{className:"text-xs text-yellow-700 space-y-1",children:[(0,o.jsxs)("div",{children:["\uD83D\uDCF1 Phone ending in ",(0,o.jsx)("strong",{children:"1111"})," → Code: ",(0,o.jsx)("code",{className:"bg-yellow-100 px-1 rounded",children:"111111"})]}),(0,o.jsxs)("div",{children:["\uD83D\uDCF1 Phone ending in ",(0,o.jsx)("strong",{children:"2222"})," → Code: ",(0,o.jsx)("code",{className:"bg-yellow-100 px-1 rounded",children:"222222"})]}),(0,o.jsxs)("div",{children:["\uD83D\uDCF1 Phone ending in ",(0,o.jsx)("strong",{children:"9999"})," → Code: ",(0,o.jsx)("code",{className:"bg-yellow-100 px-1 rounded",children:"999999"})]}),(0,o.jsxs)("div",{children:["\uD83D\uDCF1 All other phones → Code: ",(0,o.jsx)("code",{className:"bg-yellow-100 px-1 rounded",children:"123456"})]})]}),(0,o.jsxs)("p",{className:"text-xs text-yellow-600 mt-2 italic",children:["Current phone: ",r," → Use code: ",(0,o.jsx)("strong",{children:r.endsWith("1111")?"111111":r.endsWith("2222")?"222222":r.endsWith("9999")?"999999":"123456"})]})]})]}),(0,o.jsx)("button",{onClick:y,disabled:m||6!==c.length,className:"w-full py-3 rounded-xl font-medium transition-all duration-200 ".concat(m||6!==c.length?"bg-slate-200 text-slate-500 cursor-not-allowed":"bg-gradient-to-r from-cyan-500 to-teal-600 text-white hover:from-cyan-600 hover:to-teal-700 shadow-lg"),children:m?(0,o.jsxs)("div",{className:"flex items-center justify-center space-x-2",children:[(0,o.jsx)("div",{className:"w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin"}),(0,o.jsx)("span",{children:"Verifying..."})]}):"Verify Code"}),(0,o.jsx)("button",{onClick:()=>s("phone"),className:"w-full py-2 text-sm text-slate-600 hover:text-slate-800",children:"← Back to phone number"})]})}),(0,o.jsxs)("div",{className:"bg-cyan-50 border border-cyan-200 rounded-xl p-4 mt-6",children:[(0,o.jsx)("h3",{className:"text-sm font-semibold text-cyan-800 mb-2",children:"\uD83D\uDCF1 Phone Verification"}),(0,o.jsx)("p",{className:"text-xs text-cyan-700",children:"Verify your phone number to complete your account setup and access all features."})]})]}),(0,o.jsx)("div",{className:"fixed bottom-0 left-0 right-0 bg-white/95 backdrop-blur-xl border-t border-cyan-200/50 shadow-lg z-50",children:(0,o.jsx)("div",{className:"max-w-md mx-auto p-4 text-center",children:(0,o.jsx)("p",{className:"text-sm text-slate-600",children:"\uD83D\uDCF1 Complete phone verification to continue"})})})]})}},8856:(e,t,s)=>{Promise.resolve().then(s.bind(s,8818))}},e=>{e.O(0,[8441,5964,7358],()=>e(e.s=8856)),_N_E=e.O()}]);